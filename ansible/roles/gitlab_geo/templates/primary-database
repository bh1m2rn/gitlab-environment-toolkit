# if we don't have a geo_primary_site_postgres_primary then we are assuming that this is a single node machine.
# this means we don't have to set the primary role as thats already been done but we do need to set some
# extra config that would usually be set on the postgres node, but not on a single.
{% if 'geo_primary_site_postgres_primary' in groups %}
geo_primary_role['enable'] = true
{% else %}
gitlab_rails['db_password'] = "{{ postgres_password }}"

postgresql['sql_user_password'] = "{{ (postgres_password + 'gitlab') | md5 }}"
postgresql['listen_address'] = "{{ geo_primary_site_postgres_int_ip }}"
postgresql['max_replication_slots'] = 1
{% endif %}
postgresql['md5_auth_cidr_addresses'] = ['127.0.0.1/32', '{{ ansible_default_ipv4.address }}/32', '{{ geo_secondary_site_postgres_int_ip }}/32']