- name: Secondary App Servers - Add new config
  blockinfile:
    path: /etc/gitlab/gitlab.rb
    block: "{{ lookup('template', '../templates/secondary-app-servers') }}"
    marker: "# {mark} geo config block - secondary-app-servers"

- name: Secondary Frontend App Servers - Add new config
  blockinfile:
    path: /etc/gitlab/gitlab.rb
    block: "{{ lookup('template', '../templates/secondary-frontend-app-servers') }}"
    marker: "# {mark} geo config block - secondary-frontend-app-servers"

- name: Secondary Frontend App Servers - Run gitlab-ctl reconfigure
  throttle: 1
  shell: gitlab-ctl reconfigure

- name: Secondary Frontend App Servers - Run gitlab-ctl restart
  shell: gitlab-ctl restart